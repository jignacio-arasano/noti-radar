<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head th:replace="~{fragments :: head}"></head>
<body>
<div th:replace="~{fragments :: navbar}"></div>

<main class="container">
  <section class="card">
    <div class="card-header">
      <div>
        <h2 style="margin:0 0 6px 0;">Comparar contenido</h2>
        <div class="hint">
          Página: <a th:href="${page.url}" target="_blank" rel="noopener" th:text="${page.url}">URL</a>
        </div>
      </div>
      <div class="toolbar">
        <a class="btn" th:href="@{'/pages/' + ${page.id} + '/versions'}">← Volver a versiones</a>
        <div class="spacer"></div>
        <button class="btn" type="button" id="wrapBtn" title="Alternar ajuste de líneas">↔ Ajuste líneas</button>
      </div>
    </div>

    <div class="card-body diff-root wrap">
      <div class="diff-grid">
        <div class="diff-col">
          <div class="diff-header">
            <b>Versión seleccionada</b>
            <span class="badge badge-warn">
                <span class="mono"
                      th:text="${#temporals.format(version.createdAt, 'dd/MM/yyyy HH:mm')}">fecha</span>
              </span>
          </div>
          <div class="diff-pre-wrap">
            <div id="preLeft" class="mono diff-pre">
              <th:block th:if="${versionContent != null and versionContent.startsWith('NOTI_RADAR_SECTION_VIEW::')}">
                <th:block th:with="content=${versionContent.substring(27)}">
                  <div th:each="line : ${content.split('\\n\\n')}" style="margin-bottom: 1em;">
                    <th:block th:with="parts=${line.split('\\n')}">
                      <strong th:if="${parts.length > 0}" th:text="${parts[0]}">Título de la noticia</strong>
                      <br th:if="${parts.length > 1}"/>
                      <a th:if="${parts.length > 1}" th:href="${parts[1]}" th:text="${parts[1]}" target="_blank" rel="noopener">https://...</a>
                    </th:block>
                  </div>
                </th:block>
              </th:block>
              <pre th:unless="${versionContent != null and versionContent.startsWith('NOTI_RADAR_SECTION_VIEW::')}" th:text="${versionContent}"></pre>
            </div>
          </div>
        </div>

        <div class="diff-col">
          <div class="diff-header">
            <b>Versión actual</b>
            <span class="badge badge-ok">Actual</span>
          </div>
          <div class="diff-pre-wrap">
            <div id="preRight" class="mono diff-pre">
              <th:block th:if="${currentContent != null and currentContent.startsWith('NOTI_RADAR_SECTION_VIEW::')}">
                <th:block th:with="content=${currentContent.substring(27)}">
                  <div th:each="line : ${content.split('\\n\\n')}" style="margin-bottom: 1em;">
                    <th:block th:with="parts=${line.split('\\n')}">
                      <strong th:if="${parts.length > 0}" th:text="${parts[0]}">Título de la noticia</strong>
                      <br th:if="${parts.length > 1}"/>
                      <a th:if="${parts.length > 1}" th:href="${parts[1]}" th:text="${parts[1]}" target="_blank" rel="noopener">https://...</a>
                    </th:block>
                  </div>
                </th:block>
              </th:block>
              <pre th:unless="${currentContent != null and currentContent.startsWith('NOTI_RADAR_SECTION_VIEW::')}" th:text="${currentContent}"></pre>
            </div>
          </div>
        </div>
      </div>

      <div class="hint" style="margin-top:12px">
        Tip: Usá <b>↔ Ajuste líneas</b> para alternar entre envoltura (sin overflow) y texto sin envolver (con scroll horizontal interno).
      </div>
    </div>
  </section>
</main>

<style>
  .diff-root{ overflow-x: hidden; }
  .diff-grid{
    display:grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap:16px;
    width:100%;
    max-width:100%;
  }
  .diff-col{
    min-width:0;
    display:flex;
    flex-direction:column;
    gap:8px;
  }
  .diff-header{display:flex;align-items:center;justify-content:space-between;gap:10px;min-width:0}
  .diff-pre-wrap{
    border:1px solid var(--border);
    border-radius:12px;
    background:var(--bg);
    overflow:hidden;
    max-width:100%;
    box-shadow:var(--shadow);
  }
  .diff-pre{
    margin:0;
    padding:12px;
    max-height:70vh;
    overflow:auto;
    width:100%;
    box-sizing:border-box;
    white-space:pre-wrap;
    word-break:break-word;
    overflow-wrap:anywhere;
  }
  /* Estilo para el div que renderiza HTML */
  .diff-pre div {
      white-space: pre-wrap;
      word-break: break-word;
      overflow-wrap: anywhere;
  }
  /* Estilo para el pre que renderiza texto plano */
  .diff-pre pre {
      margin: 0;
      font-family: inherit;
      white-space: pre-wrap;
      word-break: break-word;
      overflow-wrap: anywhere;
  }
  .diff-root.nowrap .diff-pre div,
  .diff-root.nowrap .diff-pre pre {
    white-space:pre;
    word-break:normal;
    overflow-wrap:normal;
  }
  @media (max-width: 900px){
    .diff-grid{ grid-template-columns: 1fr; }
  }
</style>

<script>
  (function(){
    const root = document.querySelector('.diff-root');
    const btnWrap = document.getElementById('wrapBtn');
    const left = document.getElementById('preLeft');
    const right = document.getElementById('preRight');

    btnWrap.addEventListener('click', () => {
      root.classList.toggle('wrap');
      root.classList.toggle('nowrap');
    });

  })();
</script>
</body>
</html>

