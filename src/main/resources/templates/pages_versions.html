<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head th:replace="~{fragments :: head}"></head>
<body>
<div th:replace="~{fragments :: navbar}"></div>

<main class="container"><!-- main-container-open -->
    <section class="card"><!-- section-card-open -->
        <div class="card-header"><!-- card-header-open -->
            <div><!-- header-intro-open -->
                <h2 style="margin:0 0 6px 0;">Versiones</h2>
                <div class="hint">Historial de capturas para: <a th:href="${page.url}" target="_blank" rel="noopener" th:text="${page.url}"><!-- page-link-open -->URL</a><!-- page-link-close --></div>
            </div><!-- header-intro-close -->
            <div class="toolbar"><!-- toolbar-open -->
                <div class="searchbar"><!-- searchbar-open -->
                    <span class="icon">🔎</span>
                    <input id="q" type="search" placeholder="Filtrar por hash..." aria-label="Buscar por hash"/>
                </div><!-- searchbar-close -->
                <a class="btn" th:href="@{'/pages'}"><!-- back-link-open -->← Páginas</a><!-- back-link-close -->
            </div><!-- toolbar-close -->
        </div><!-- card-header-close -->

        <div class="card-body"><!-- card-body-open -->
            <div class="table-wrap"><!-- table-wrap-open -->
                <table id="versionsTable">
                    <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Hash</th>
                        <th style="text-align:right">Acciones</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="v : ${versions}" th:attr="data-hash=${v.hash}">
                        <td class="mono">
                            <time th:text="${#temporals.format(v.createdAt, 'dd/MM/yyyy HH:mm')}"
                                  th:attr="datetime=${#temporals.formatISO(v.createdAt)}"></time>
                        </td>
                        <td class="mono">
                            <span th:text="${v.hash}">hash</span>
                            <button class="btn btn-ghost" type="button" title="Copiar hash"
                                    onclick="navigator.clipboard.writeText(this.previousElementSibling.textContent)"><!-- copy-btn-open -->
                                📋 <span class="txt">Copiar</span>
                            </button><!-- copy-btn-close -->
                        </td>
                        <td class="actions" style="text-align:right"><!-- actions-cell-open -->
                            <a class="btn" th:href="@{'/pages/' + ${page.id} + '/diff/' + ${v.id}}"><!-- diff-link-open -->🧩 <span class="txt">Ver diff</span></a><!-- diff-link-close -->
                        </td><!-- actions-cell-close -->
                    </tr>
                    <tr th:if="${#lists.isEmpty(versions)}">
                        <td colspan="3" style="text-align:center;color:var(--muted);padding:18px">
                            Aún no hay versiones guardadas para esta página.
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div><!-- table-wrap-close -->
            <div style="margin-top:10px" class="hint"><!-- hint-open -->
                Tip: copiá un hash para comparaciones externas.
            </div><!-- hint-close -->
        </div><!-- card-body-close -->
    </section><!-- section-card-close -->
</main><!-- main-container-close -->

<script>
    (function(){
      const q = document.getElementById('q');
      const rows = Array.from(document.querySelectorAll('#versionsTable tbody tr'))
        .filter(tr => tr.hasAttribute('data-hash'));
      function apply(){
        const term = (q.value || '').toLowerCase().trim();
        rows.forEach(tr => {
          const h = (tr.getAttribute('data-hash') || '').toLowerCase();
          tr.style.display = (!term || h.includes(term)) ? '' : 'none';
        });
      }
      q.addEventListener('input', apply);
    })();
</script>
</body>
</html>
